<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Kas - Loran Management</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
        .chart-bar {
            height: 20px;
            border-radius: 4px;
            margin-bottom: 4px;
            position: relative;
        }

        .chart-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 2px;
        }
    </style>
</head>

<body>

    <header class="container flex items-center gap-md" style="padding-top: var(--spacing-lg);">
        <a href="index.html" style="color: var(--text-dark); font-size: 1.5rem;">
            <ion-icon name="arrow-back-outline"></ion-icon>
        </a>
        <h1 class="text-xl font-bold">Laporan Kas Transparan</h1>
    </header>

    <main class="container main-content animate-fade-in">

        <!-- Summary Cards -->
        <div class="flex gap-md" style="margin-bottom: var(--spacing-md);">
            <div class="card" style="flex: 1; margin-bottom: 0; padding: var(--spacing-md);">
                <div class="text-sm text-muted">Pemasukan Bulan Ini</div>
                <div class="font-bold text-success text-lg" style="margin-top: 4px;">Rp 5.2Jt</div>
            </div>
            <div class="card" style="flex: 1; margin-bottom: 0; padding: var(--spacing-md);">
                <div class="text-sm text-muted">Pengeluaran Bulan Ini</div>
                <div class="font-bold text-danger text-lg" style="margin-top: 4px;">Rp 1.5Jt</div>
            </div>
        </div>

        <!-- Monthly Chart (Simple CSS) -->
        <section class="card">
            <h3 class="font-bold text-lg" style="margin-bottom: var(--spacing-md);">Grafik Arus Kas 2025</h3>

            <div style="margin-bottom: var(--spacing-md);">
                <div class="chart-label"><span>Oktober</span> <span>+5.2jt | -1.5jt</span></div>
                <div class="chart-bar" style="width: 80%; background-color: var(--secondary-green); opacity: 0.8;">
                </div>
                <div class="chart-bar" style="width: 25%; background-color: var(--danger-red); opacity: 0.8;"></div>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
                <div class="chart-label"><span>September</span> <span>+4.8jt | -1.2jt</span></div>
                <div class="chart-bar" style="width: 75%; background-color: var(--secondary-green); opacity: 0.6;">
                </div>
                <div class="chart-bar" style="width: 20%; background-color: var(--danger-red); opacity: 0.6;"></div>
            </div>

            <div style="margin-bottom: var(--spacing-sm);">
                <div class="chart-label"><span>Agustus</span> <span>+5.0jt | -2.0jt</span></div>
                <div class="chart-bar" style="width: 78%; background-color: var(--secondary-green); opacity: 0.6;">
                </div>
                <div class="chart-bar" style="width: 35%; background-color: var(--danger-red); opacity: 0.6;"></div>
            </div>
        </section>


        <!-- Payment Status Section -->
        <section class="card">
            <h3 class="font-bold text-lg" style="margin-bottom: var(--spacing-md);">Status Pembayaran (Oktober 2025)
            </h3>

            <div class="flex gap-md" style="margin-bottom: var(--spacing-md);">
                <!-- Summary Counts -->
                <div style="flex: 1; text-align: center; padding: 8px; background-color: #E8F5E9; border-radius: 8px;">
                    <div class="font-bold text-success text-lg">42</div>
                    <div class="text-xs text-muted">Sudah Bayar</div>
                </div>
                <div style="flex: 1; text-align: center; padding: 8px; background-color: #FFEBEE; border-radius: 8px;">
                    <div class="font-bold text-danger text-lg">15</div>
                    <div class="text-xs text-muted">Belum Bayar</div>
                </div>
            </div>

            <div class="flex flex-col gap-sm">
                <details>
                    <summary class="font-bold text-success" style="cursor: pointer; padding: 8px 0; outline: none;">
                        Lihat Daftar Sudah Bayar (42)</summary>
                    <ul style="list-style: none; padding: 0; margin-top: 8px; max-height: 200px; overflow-y: auto;">
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span>Bpk. Agus (Blok A3)</span> <ion-icon name="checkmark-circle"
                                class="text-success"></ion-icon>
                        </li>
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span>Ibu Siti (Blok B5)</span> <ion-icon name="checkmark-circle"
                                class="text-success"></ion-icon>
                        </li>
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span>Bpk. Raharjo (Blok A1)</span> <ion-icon name="checkmark-circle"
                                class="text-success"></ion-icon>
                        </li>
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span>Ibu Lina (Blok C1)</span> <ion-icon name="checkmark-circle"
                                class="text-success"></ion-icon>
                        </li>
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span class="text-muted text-sm italic">Dan 38 lainnya...</span>
                        </li>
                    </ul>
                </details>

                <details open>
                    <summary class="font-bold text-danger" style="cursor: pointer; padding: 8px 0; outline: none;">Lihat
                        Daftar Belum Bayar (15)</summary>
                    <ul style="list-style: none; padding: 0; margin-top: 8px;">
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span class="font-bold">Bpk. Budi Santoso (Anda)</span> <span class="badge"
                                style="background-color: var(--danger-red); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">Belum</span>
                        </li>
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span>Bpk. Joko (Blok C2)</span> <span class="badge"
                                style="background-color: var(--danger-red); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">Belum</span>
                        </li>
                        <li class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px dashed #eee;">
                            <span>Ibu Wati (Blok D4)</span> <span class="badge"
                                style="background-color: var(--danger-red); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">Belum</span>
                        </li>
                    </ul>
                </details>
            </div>
        </section>

        <!-- Transaction List -->
        <section class="card">
            <div class="flex justify-between items-center" style="margin-bottom: var(--spacing-md);">
                <h3 class="font-bold text-lg">Mutasi Terakhir</h3>
                <select id="transaction-filter" class="select"
                    style="width: auto; padding: 4px 8px; font-size: 0.8rem;">
                    <option value="newest">Terbaru</option>
                    <option value="oldest">Terlama</option>
                    <option value="alphabetical">Abjad (A-Z)</option>
                    <option value="last_month">Bulan Lalu</option>
                </select>
            </div>

            <div class="flex flex-col gap-md" id="transaction-list">
                <!-- Items will be populated by JS -->
            </div>

            <script>
                // Transaction Data (simulated database)
                const transactions = [
                    {
                        title: "Iuran Sampah & Keamanan",
                        name: "Bpk. Budi Santoso (Blok A1)",
                        date: "2025-10-18T14:30:00",
                        amount: 50000,
                        type: "in"
                    },
                    {
                        title: "Perbaikan Jalan Utama",
                        name: "Material Bangunan",
                        date: "2025-10-17T09:15:00",
                        amount: -1200000,
                        type: "out"
                    },
                    {
                        title: "Iuran Sampah & Keamanan",
                        name: "Ibu Siti (Blok B5)",
                        date: "2025-10-16T10:00:00",
                        amount: 50000,
                        type: "in"
                    },
                    {
                        title: "Konsumsi Rapat Warga",
                        name: "Snack Box",
                        date: "2025-10-15T19:00:00",
                        amount: -300000,
                        type: "out"
                    },
                    // Add some older data for "Last Month" testing
                    {
                        title: "Iuran Sampah & Keamanan",
                        name: "Bpk. Agus (Blok A3)",
                        date: "2025-09-15T08:00:00",
                        amount: 50000,
                        type: "in"
                    },
                    {
                        title: "Pembelian Alat Kebersihan",
                        name: "Toko Makmur",
                        date: "2025-09-10T11:00:00",
                        amount: -150000,
                        type: "out"
                    }
                ];

                const listContainer = document.getElementById('transaction-list');
                const filterSelect = document.getElementById('transaction-filter');

                function formatRupiah(amount) {
                    const prefix = amount < 0 ? '-' : '+';
                    return prefix + Math.abs(amount).toLocaleString('id-ID');
                }

                function formatDate(dateString) {
                    const options = { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' };
                    return new Date(dateString).toLocaleDateString('id-ID', options);
                }

                function renderTransactions(data) {
                    listContainer.innerHTML = '';

                    if (data.length === 0) {
                        listContainer.innerHTML = '<div class="text-center text-muted" style="padding: 20px;">Tidak ada data ditemukan</div>';
                        return;
                    }

                    data.forEach(t => {
                        const colorClass = t.type === 'in' ? 'text-success' : 'text-danger';
                        const itemHtml = `
                            <div class="flex justify-between items-center" style="border-bottom: 1px solid #F3F4F6; padding-bottom: 8px;">
                                <div>
                                    <div class="font-bold text-sm">${t.title}</div>
                                    <div class="text-sm text-muted">${t.name}</div>
                                    <div class="text-sm text-muted" style="font-size: 0.7rem;">${formatDate(t.date)}</div>
                                </div>
                                <div class="font-bold ${colorClass} text-sm">${formatRupiah(t.amount)}</div>
                            </div>
                        `;
                        const div = document.createElement('div');
                        div.innerHTML = itemHtml;
                        listContainer.appendChild(div); // Appending the wrapper div for simplicity, though adding innerHTML direct to loop is fine too
                    });
                }

                function filterAndSort(criteria) {
                    let filteredData = [...transactions];
                    const now = new Date(); // In actual app this would be real Date, here we assumecontext is 2025
                    // Mocking "Current" as Oct 2025 based on page context for "Last Month" logic
                    const currentContextDate = new Date("2025-10-31");

                    if (criteria === 'last_month') {
                        filteredData = filteredData.filter(t => {
                            const tDate = new Date(t.date);
                            // Simple check: is Month == CurrentMonth - 1?
                            // For mock context Oct 2025, last month is Sept 2025
                            return tDate.getMonth() === 8 && tDate.getFullYear() === 2025; // 8 is Sept
                        });
                    }

                    // Sorting
                    if (criteria === 'newest') {
                        filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));
                    } else if (criteria === 'oldest') {
                        filteredData.sort((a, b) => new Date(a.date) - new Date(b.date));
                    } else if (criteria === 'alphabetical') {
                        filteredData.sort((a, b) => a.title.localeCompare(b.title));
                    }

                    // If filter is not last_month, sorting logic applies to all or pre-filtered? 
                    // User request: "filter terbaru, filter terlama" implies sorting. "Filter bulan lalu" implies subset.
                    // The standard UI pattern is: sort is applied to the visible set. 
                    // However, here the dropdown mixes "Sort" and "Filter". 
                    // "Bulan Lalu" acts as a mode.

                    // If "Bulan Lalu" selected, it shows last month data sorted by newest (default).
                    // If others selected, it shows ALL data sorted by that criteria.

                    renderTransactions(filteredData);
                }

                filterSelect.addEventListener('change', (e) => {
                    filterAndSort(e.target.value);
                });

                // Initial load
                renderTransactions(transactions); // Defaults to implicit order (defined in array), which is somewhat mixed but mostly newest top. 
                // Let's force proper default sort
                filterAndSort('newest'); 
            </script>

            <button class="btn btn-outline" style="margin-top: var(--spacing-md); width: 100%;">
                Muat Lebih Banyak
            </button>
        </section>

    </main>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <ion-icon name="home-outline" class="nav-icon"></ion-icon>
            <span>Beranda</span>
        </a>
        <a href="payment.html" class="nav-item">
            <ion-icon name="card-outline" class="nav-icon"></ion-icon>
            <span>Bayar</span>
        </a>
        <a href="admin.html" class="nav-item">
            <ion-icon name="grid-outline" class="nav-icon"></ion-icon>
            <span>Admin</span>
        </a>
        <a href="profile.html" class="nav-item">
            <ion-icon name="person-outline" class="nav-icon"></ion-icon>
            <span>Profil</span>
        </a>
    </nav>

</body>

</html>